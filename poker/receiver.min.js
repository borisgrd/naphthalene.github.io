var BigBlindToken,Button,ButtonGroup,CardImage,Col,ConnectedPlayers,DealerToken,DropdownButton,Flush,FourOfAKind,FullHouse,Grid,HighCard,InitState,Input,Jumbotron,Label,ListGroup,ListGroupItem,MainState,MenuItem,Nav,NavItem,Navbar,OnePair,PageHeader,Panel,Players,Row,RoyalFlush,SmallBlindToken,Straight,StraightFlush,Table,TableInfo,ThreeOfAKind,TwoPair,Well,displayText,table,extend=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hasProp={}.hasOwnProperty;DropdownButton=ReactBootstrap.DropdownButton,ListGroupItem=ReactBootstrap.ListGroupItem,ButtonGroup=ReactBootstrap.ButtonGroup,PageHeader=ReactBootstrap.PageHeader,Jumbotron=ReactBootstrap.Jumbotron,ListGroup=ReactBootstrap.ListGroup,MenuItem=ReactBootstrap.MenuItem,NavItem=ReactBootstrap.NavItem,Button=ReactBootstrap.Button,Navbar=ReactBootstrap.Navbar,Input=ReactBootstrap.Input,Table=ReactBootstrap.Table,Label=ReactBootstrap.Label,Panel=ReactBootstrap.Panel,Grid=ReactBootstrap.Grid,Well=ReactBootstrap.Well,Row=ReactBootstrap.Row,Col=ReactBootstrap.Col,Nav=ReactBootstrap.Nav,CardImage=React.createClass({render:function(){return React.createElement("object",{data:this.props.card?"/images/"+("H"===this.props.card[this.props.card.length-1]?"Hearts":"S"===this.props.card[this.props.card.length-1]?"Spades":"C"===this.props.card[this.props.card.length-1]?"Clubs":"D"===this.props.card[this.props.card.length-1]?"Diamonds":void 0)+"/"+this.props.card+".svg":"/images/card_outline.svg",type:"image/svg+xml",width:"100px",className:this.props.className})}}),TableInfo=React.createClass({render:function(){return React.createElement("div",{className:"vertical-center"},React.createElement(Panel,{header:"Community Cards - "+this.props.communityState,className:"panel-transparent"},React.createElement("ul",{className:"list-inline"},React.createElement("li",null,React.createElement(CardImage,{card:this.props.cards.flop[0]})),React.createElement("li",null,React.createElement(CardImage,{card:this.props.cards.flop[1]})),React.createElement("li",null,React.createElement(CardImage,{card:this.props.cards.flop[2]})),React.createElement("li",null,React.createElement(CardImage,{card:this.props.cards.turn})),React.createElement("li",null,React.createElement(CardImage,{card:this.props.cards.river}))),React.createElement("ul",{className:"list-inline"},React.createElement("li",null,"Hand ",React.createElement(Label,{bsStyle:"default"},"#"+this.props.hand)),React.createElement("li",null,"Current bid: ",React.createElement(Label,{bsStyle:"danger"},"$"+this.props.bid)),React.createElement("li",null,"Total pot: ",React.createElement(Label,{bsStyle:"info"},"$"+this.props.pot)))))}}),ConnectedPlayers=React.createClass({render:function(){return React.createElement(Panel,{header:"Connected players"},React.createElement(Table,{striped:!0,bordered:!0,condensed:!0},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"name"))),this.props.players.map(function(a){return React.createElement("tr",null,React.createElement("td",null,a.name))})))}}),DealerToken=React.createClass({render:function(){return React.createElement("p",{className:"dealer"},"Dealer")}}),SmallBlindToken=React.createClass({render:function(){return React.createElement("p",{className:"small-blind"},"Small Blind")}}),BigBlindToken=React.createClass({render:function(){return React.createElement("p",{className:"big-blind"},"Big Blind")}}),Players=React.createClass({render:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o;for(m=Math.PI/this.props.players.length,a=m/2,j=500,h=window.innerWidth/2-100,l=[],d=0,k=this.props.players,e=0,g=k.length;g>e;e++)i=k[e],f=j*Math.cos(a)+h+"px",o=j*Math.sin(a)-100+"px",n={left:f,top:o},b="semicircle panel-transparent "+(this.props.turn===i.name?"player-turn":""),a+=m,c=i.name,l.push(React.createElement(Panel,{key:d,className:b,style:n,header:i.name},i.fold?React.createElement("p",null,"FOLD"):React.createElement("p",null,"Bid: $"+i.bid),i.dealer?React.createElement(DealerToken,null):"S"===i.blind?React.createElement(SmallBlindToken,null):"B"===i.blind?React.createElement(BigBlindToken,null):"")),d+=1;return React.createElement("div",{id:"player-display"},l)}}),InitState=React.createClass({handleMessage:function(a,b,c){return"start"===c.action?(window.messageBus.broadcast(JSON.stringify({status:"start",data:c.data})),table.setState("main",{})):void 0},getInitialState:function(){return{players:[]}},render:function(){return React.createElement("div",null,React.createElement(Grid,{id:"game-grid"},React.createElement(Row,{id:"row-game-main",className:"row-centered"},React.createElement(Col,{xs:8,md:8,lg:6},React.createElement("h3",null,"Waiting for players to join..."),React.createElement(ConnectedPlayers,{players:this.state.players})))))}}),MainState=React.createClass({endHand:function(a){return console.log("Awarding "+this.state.players[a].name),this.awardPotTo(a),table.deck=this.shuffle(this.generateSortedDeck()),this.setState({dealer:(this.state.dealer+1)%this.state.players.length}),this.dealHand(this.state.dealer)},combinations:function(a,b){var c,d;return c=a.length,b>c?[]:b?b===c?[a]:(d=function(c,d,e){return c.concat(this.combinations(a.slice(e+1),b-1).map(function(a){return[d].concat(a)}))},a.reduce(d,[])):[[]]},computeWinner:function(){var a,b,c,d;return a=this.state.communityCards,d=function(a){return["2","3","4","5","6","7","8","9","10","J","Q","K","A"].indexOf(a.slice(0,-1))},c=function(a){return a.slice(-1)[0]},b=function(b,e,f){var g,h,i,j;return j=e.hand,j=j.concat(a.flop),j.push(a.turn),j.push(a.river),j=this.sortHand(j),console.log("Player "+this.state.players[f].name+" has this sorted hand: "+j),console.log("Current best player is: "+b[1]),i=function(a,b){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;return g=this.dupCounts(b.map(function(a){return d(a)})),h=b.every(function(a,b,d){return!b||c(a)===c(d[0])}),f=function(a,b,c,e){var f,g,h,i;return i=function(a,b){var f;return f=12===a&&4===c&&!d(e[0]),[f||a===b+1,f]},g=i(d(b),a[1]),f=g[0],h=g[1],[!c||a[0]&&f,h?3:d(b)]},m=b.reduce(f,[!0,-1]),o=m[0],p=m[1],n=h&&o&&12===p,l=2===g.length,k=l?[0,1].map(function(a){return 4===g[a][1]}).indexOf(!0):!1,e=l?[0,1].map(function(a){return 3===g[a][1]}).indexOf(!0):!1,r=3===g.length,q=r?[0,1,2].map(function(a){return 3===g[a][1]}).indexOf(!0):!1,t=function(a,b){var c;return c=2===g[b[0]][1]&&2===g[b[1]][1],a[0]?a:c?[!0,b]:a},s=r?this.combinations([0,1,2],2).reduce(t,[!1,null]):void 0,j=4===g.length?[0,1].map(function(a){return 2===g[a][1]}).indexOf(!0):!1,i=n?RoyalFlush(b):o&&h?StraightFlush(b,p):k!==!1&&-1!==k?FourOfAKind(b,g,k):e!==!1&&-1!==e?FullHouse(b,g,e):h?Flush(b):o?Straight(b):q!==!1&&-1!==q?ThreeOfAKind(b,g,q):s!==!1&&s[0]?TwoPair(b,s[1]):j!==!1&&-1!==j?OnePair(b,g,j):HighCard(b),i.rankcmp(a)>0?i:a},g=this.combinations(j).reduce(i,null),h=g.rankcmp(b[1]),h>0?[f,g]:b},this.state.players.reduce(b,[-1,null])[0]},dupCounts:function(a){var b;return b=function(a,b,c,d){var e;return a[0]!==b?(e=a[2],null!==a[0]&&(e=e.concat([[a[0],a[1]]])),c===d.length-1&&(e=e.concat([[b,1]])),[b,1,e]):c===d.length-1?(e=a[2],e=e.concat([[a[0],++a[1]]]),[a[0],a[1],e]):[a[0],++a[1],a[2]]},a.reduce(b,[null,0,[]])[2]},sortHand:function(a){var b,c;return b=["2","3","4","5","6","7","8","9","10","J","Q","K","A"],c=function(a,c){return a.slice(0,-1)===c.slice(0,-1)?0:b.indexOf(a.slice(0,-1))>b.indexOf(c.slice(0,-1))},a.sort(c)},dealCommunityOrEnd:function(){switch(this.state.community){case"Preflop":return console.log("Dealing Flop..."),this.setState({communityCards:{flop:[table.deck.shift(),table.deck.shift(),table.deck.shift()]},community:"Flop"});case"Flop":return console.log("Dealing Turn..."),this.setState({communityCards:{flop:this.state.communityCards.flop,turn:table.deck.shift()},community:"Turn"}),console.log("Dealt Turn...");case"Turn":return console.log("Dealing River..."),this.setState({communityCards:{flop:this.state.communityCards.flop,turn:this.state.communityCards.turn,river:table.deck.shift()},community:"River"});case"River":return console.log("Ending hand..."),this.endHand(this.computeWinner()),this.setState({communityCards:{flop:[null,null,null],turn:null,river:null},community:"Preflop"})}},awardPotTo:function(a){var b,c;return c=this.state.players,b=c[a],b.remaining=b.remaining+this.state.pot,console.log("Awarding pot..."),c[a]=b,this.setState({players:c,pot:0,bid:0}),console.log("Awarded pot...")},nextPlayersTurnOrEndHand:function(a,b){var c,d,e,f,g,h;try{for(g=(a+1)%this.state.players.length,e=!1,c=!0;g!==a&&!e;){if(e=!this.state.players[g].fold){c=!1;break}g=(g+1)%this.state.players.length}if(e&&(h=this.state.players.map(function(a){return!a.fold}).reduce(function(a,b){return b?a+1:a},0),console.log("Number of active players: "+h),h>1?(this.setState({turn:this.state.players[g].name}),window.messageBus.broadcast(JSON.stringify({status:"turn",data:{turn:this.state.turn}}))):(f=!0,c=!0)),"check"===b&&this.state.lastRaised===a&&(c=!0),c&&(console.log("This round of bidding is over"),this.dealCommunityOrEnd(),f))return console.log("handOver"),console.log(this.state.players[g].name+" has won"),this.endHand(g)}catch(i){return d=i,console.error(d.stack)}},playerAction:function(a,b,c){var d,e,f;return e=this.state.players.map(function(a){return a.id}).indexOf(a),f=this.state.players,console.log("pi is "+e),d=f[e],c(d,e),f[e]=d,this.setState({players:f}),this.nextPlayersTurnOrEndHand(e,b)},foldPlayer:function(a){return this.playerAction(a,"fold",function(a){return a.fold=!0,console.log(a.name+" has folded their hand")})},raisePlayer:function(a,b){return this.playerAction(a,"raise",function(c,d){var e,f;try{return console.log(c.name+" raised by "+b.amount),f=this.state.bid-c.bid+b.amount,console.log(c.name+" is adding "+f+" to the pot"),c.remaining-f>=0?(c.bid=c.bid+f,c.remaining=c.remaining-f,that.setState({lastRaised:d,bid:c.bid,pot:this.state.pot+f}),window.messageBus.send(a,JSON.stringify({status:"raiseok",data:{remaining:c.remaining,bid:c.bid}})),window.messageBus.broadcast(JSON.stringify({status:"maxbid",data:{maxbid:this.state.bid}}))):window.messageBus.send(a,JSON.stringify({status:"raisefail",data:{reason:"Insufficient funds to raise this much"}}))}catch(g){return e=g,console.error(e)}})},callPlayer:function(a){var b;return b=this,this.playerAction(a,"call",function(c){var d;return d=this.state.bid-c.bid,c.remaining-d>=0?(c.bid=c.bid+d,c.remaining=c.remaining-d,b.setState({pot:this.state.pot+d}),window.messageBus.send(a,JSON.stringify({status:"callok",data:{remaining:c.remaining,pot:this.state.pot+d,bid:c.bid}}))):window.messageBus.send(a,JSON.stringify({status:"callfail",data:{reason:"Insufficient funds to call the bid"}}))})},checkPlayer:function(a){var b;return b=this,this.playerAction(a,"check",function(b){return b.bid===this.state.bid?window.messageBus.send(a,JSON.stringify({status:"checkok",data:{}})):window.messageBus.send(a,JSON.stringify({status:"checkfail",data:{reason:"You must call or fold since your bid doesn't match current top bid"}}))})},handleMessage:function(a,b,c){switch(c.action){case"fold":return this.foldPlayer(b);case"raise":return this.raisePlayer(b,c.data);case"call":return this.callPlayer(b);case"check":return this.checkPlayer(b);default:return console.error("Unknown message received")}},generateSortedDeck:function(){var a,b,c,d,e,f,g,h,i;for(i=["H","D","S","C"],c=["2","3","4","5","6","7","8","9","10","J","Q","K","A"],a=[],d=0,e=i.length;e>d;d++)for(h=i[d],g=0,f=c.length;f>g;g++)b=c[g],a.push(b+h);return a},shuffle:function(a){var b,c,d;for(b=a.length;b>0;)c=Math.floor(Math.random()*b),b--,d=a[b],a[b]=a[c],a[c]=d;return a},dealHand:function(a){var b,c,d,e,f,g,h,i,j,k,l,m;for(k=[],f=0,m=(a+1)%table.players.length,c=(m+1)%table.players.length,l=this.state.players,g=0,h=l.length;h>g;g++){i=l[g],b=m===f?table.rules.smallBlind:c===f?table.rules.bigBlind:0,j={id:i.id,name:i.name,dealer:a===f,blind:m===f?"S":c===f?"B":"N",bid:b,remaining:i.remaining-b,fold:!1,hand:[table.deck.shift(),table.deck.shift()]},k.push(j);try{window.messageBus.send(j.id,JSON.stringify({status:"deal",data:j}))}catch(n){d=n,console.error(d)}f++}e=k[(c+1)%k.length].name;try{window.messageBus.broadcast(JSON.stringify({status:"turn",data:{turn:e}})),window.messageBus.broadcast(JSON.stringify({status:"maxbid",data:{maxbid:table.rules.bigBlind}})),this.setState({players:k,bid:table.rules.bigBlind,pot:table.rules.bigBlind+table.rules.smallBlind,hand:this.state.hand+1})}catch(n){d=n,console.error(d)}return[c,e,k]},getInitialState:function(){var a,b,c,d,e,f,g,h,i,j,k,l;for(table.deck=this.shuffle(this.generateSortedDeck()),c=Math.floor(Math.random()*table.players.length),l=(c+1)%table.players.length,b=(l+1)%table.players.length,d=table.players[(b+1)%table.players.length].name,e=0,j=[],k=table.players,f=0,g=k.length;g>f;f++)h=k[f],a=l===e?table.rules.smallBlind:b===e?table.rules.bigBlind:0,i={id:h.id,name:h.name,dealer:!1,blind:"N",bid:0,remaining:table.rules.buyIn,fold:!1,hand:[null,null]},j.push(i),e++;return{community:"Preflop",communityCards:{flop:[null,null,null],turn:null,river:null},players:j,dealer:c,turn:d,lastRaised:b,bid:0,pot:0,hand:0}},componentDidMount:function(){return this.dealHand(this.state.dealer)},render:function(){return React.createElement("div",null,React.createElement(TableInfo,{cards:this.state.communityCards,communityState:this.state.community,bid:this.state.bid,pot:this.state.pot,hand:this.state.hand}),React.createElement(Players,{players:this.state.players,turn:this.state.turn}))}}),HighCard=function(){function a(a){this.hand=a,this.rank="HC"}return a.prototype.intcmp=function(a,b){return a>b?1:b>a?-1:0},a.prototype.zipcmp=function(a,b){var c,d;return d=this,a.length!==b.length?a.length>b.length?1:-1:(c=function(a,c,e){return 0!==a?a:d.intcmp(c,b[e])},a.reduce(c,0))},a.prototype.rankcmp=function(a){var b,c,d;return null===a?1:(d=["HC","1P","2P","3K","ST","FL","FH","4K","SF","RF"],b=d.indexOf(this.rank),c=d.indexOf(a.rank),b>c?1:c>b?-1:(console.log("Same rank: "+this.rank+", using tiebreaker..."),this.tiebreaker(a)))},a.prototype.val=function(a){return["2","3","4","5","6","7","8","9","10","J","Q","K","A"].indexOf(a.slice(0,-1))},a.prototype.tiebreaker=function(a){var b,c,d,e,f,g;return g=this,f=function(a,b){return b>a?b:a},c=function(a){return g.val(a)},d=this.hand.map(c).reduce(f,-1),e=a.hand.map(c).reduce(f,-1),b=this.intcmp(d,e),0===b?(console.log("High cards are the same: "+d),this.zipcmp(this.hand.map(c),a.hand.map(c))):b},a}(),OnePair=function(a){function b(a,b,c){this.hand=a,this.counts=b,this.i=c,this.rank="1P"}return extend(b,a),b.prototype.tiebreaker=function(a){var b,c,d;return b=this.counts[this.i][0],c=a.counts[a.i][0],b===c?(d=function(a){return function(b,c,d){var e;return d===a?b:(e=b,e=e.concat([c[0]]))}},this.zipcmp(this.counts.reduce(d(this.i),[]),a.counts.reduce(d(a.i),[]))):b>c?1:-1},b}(HighCard),TwoPair=function(a){function b(a,b,c){this.hand=a,this.counts=b,this.rank="2P",this.i=c[0],this.j=c[1]}return extend(b,a),b.prototype.tiebreaker=function(a){var b,c,d,e,f,g,h,i;return i=this,h=function(a,b,c){return[a,b].map(function(a){return[a,c[a][0]]}).sort(function(a,b){return b[1]-a[1]})},d=h(this.i,this.j,this.counts),f=h(a.i,a.j,a.counts),g=function(a,b,c){return 0!==a?a:i.intcmp(b[1],f[c][1])},b=d.reduce(g,0),0===b?(console.log("Two pair is the same, reviewing kicker"),c=this.counts[3-this.i-this.j][0],e=a.counts[3-a.i-a.j][0],this.intcmp(c,e)):b},b}(HighCard),ThreeOfAKind=function(a){function b(a,b,c){this.hand=a,this.counts=b,this.ti=c,this.rank="3K"}return extend(b,a),b.prototype.tiebreaker=function(a){var b,c;return b=this.intcmp(this.counts[this.ti][0],a.counts[a.ti][0]),0!==b||(c=function(a){return function(b,c,d){var e;return d===a?b:(e=b,e=e.concat([c[0]]))}}),this.zipcmp(this.counts.reduce(c(this.ti),[]),a.counts.reduce(c(a.ti),[]))},b}(HighCard),Straight=function(a){function b(a,b){this.hand=a,this.sh=b,this.rank="ST"}return extend(b,a),b.prototype.tiebreaker=function(a){return this.intcmp(this.sh,a.sh)},b}(HighCard),Flush=function(a){function b(a){this.hand=a,this.rank="FL"}return extend(b,a),b.prototype.tiebreaker=function(a){var b,c;return b=this.hand,b.reverse(),c=a.hand,c.reverse(),this.zipcmp(b,c)},b}(HighCard),FullHouse=function(a){function b(a,b,c){this.hand=a,this.counts=b,this.fhi=c,this.rank="FH"}return extend(b,a),b.prototype.tiebreaker=function(a){var b;return b=this.intcmp(this.counts[this.fhi][0],a.counts[a.fhi][0]),0!==b?b:this.intcmp(this.counts[1-this.fhi][0],a.counts[1-a.fhi][0])},b}(HighCard),FourOfAKind=function(a){function b(a,b,c){this.hand=a,this.counts=b,this.fki=c,this.rank="4K"}return extend(b,a),b.prototype.tiebreaker=function(a){var b;return b=this.intcmp(this.counts[this.fki][0],a.counts[a.fki][0]),0!==b?b:this.intcmp(this.counts[1-this.fki][0],a.counts[1-a.fki][0])},b}(HighCard),StraightFlush=function(a){function b(a,b){this.hand=a,this.sh=b,this.rank="SF"}return extend(b,a),b}(Straight),RoyalFlush=function(a){function b(a){this.hand=a,this.rank="RF"}return extend(b,a),b.prototype.tiebreaker=function(){return 0},b}(HighCard),table={state:null,prevState:null,container:null,players:[],state_data:null,host:null,rules:{buyIn:1e3,bigBlind:10,smallBlind:5},states:{init:InitState,main:MainState},handleMessage:function(a,b){var c,d,e,f,g;switch(d=function(c){var d;return d=function(c,d){var e,f,g;return c&&d.name===b.data.name?(f=[d.id,a].map(function(a){return a.split(":")[0]}),e=f[0],g=f[1],e===g?d.id:null):void 0},c.reduce(d,!0)},b.action){case"join":if("init"===this.state)try{if(null===d(this.players))return 0===this.players.length&&(console.log("First person joined: "+b.data.name),this.host=b.data.name,window.messageBus.send(a,JSON.stringify({status:"host",data:{}}))),this.players.push({name:b.data.name,id:a}),this.container.setState({players:this.players});if(this.host===b.data.name)return window.messageBus.send(a,JSON.stringify({status:"host",data:{}}))}catch(h){return c=h,console.error(c)}else{if("main"!==this.state)return console.error("Cannot join once game has begun!");if(f=d(this.players),null!==f)return g=function(b,c,d,e){return b?b:c.id===f?(e[d].id=a,e[d]):void 0},e=this.players.reduce(g,null),window.messageBus.send(a,JSON.stringify({status:"start",data:{}}))}break;default:return this.container.handleMessage(this,a,b)}},setState:function(a,b){return this.state===a&&null!==this.container?(displayText("Updating state: "+b),this.container.setProps(b)):(displayText("Setting state to: "+a),this.prevState=this.state,this.state=a,this.container=React.render(React.createElement(this.states[a],b),document.getElementById("content")))}},window.onload=function(){return cast.receiver.logger.setLevelValue(0),window.castReceiverManager=cast.receiver.CastReceiverManager.getInstance(),"undefined"!=typeof console&&(console.olog="undefined"!=typeof console.log?console.log:function(){return{}}),console.log=function(a){return console.olog(a),displayText(a)},console.error=console.debug=console.info=console.log,console.log("Starting Receiver Manager"),table.setState("init",{}),castReceiverManager.onReady=function(a){return console.log("Received Ready event: "+JSON.stringify(a.data)),window.castReceiverManager.setApplicationState("Application status is ready...")},castReceiverManager.onSenderConnected=function(a){return console.log("Received Sender Connected event: "+a.data),console.log(window.castReceiverManager.getSender(a.datxa).userAgent)},castReceiverManager.onSenderDisconnected=function(a){return console.log("Received Sender Disconnected event: "+a.data),0===window.castReceiverManager.getSenders().length?window.close():void 0},castReceiverManager.onSystemVolumeChanged=function(a){return console.log("Received System Volume Changed event: "+a.data.level+" "+a.data.muted)},window.messageBus=window.castReceiverManager.getCastMessageBus("urn:x-cast:sadikov.apps.pokair"),window.messageBus.onMessage=function(a){return console.log("Message ["+a.senderId+"]: "+a.data),table.handleMessage(a.senderId,JSON.parse(a.data))},window.castReceiverManager.start({statusText:"Application is starting"}),console.log("Receiver Manager started")},displayText=function(a){var b;return b=document.getElementById("message"),b.innerHTML+="\n"+a,b.scrollTop=b.scrollHeight};